# Основы маршрутизации (роутинга)

[Оригинал статьи](https://nextjs.org/docs/app/building-your-application/routing)

Актуальность: 11.03.2024

---



Скелетом любого приложения является маршрутизация (роутинг). На этой странице вы познакомитесь с фундаментальными понятиями роутинга для веба и узнаете, как работать с маршрутизацией в Next.js.

## Терминология

Прежде всего, вы увидите, что эти термины используются во всей документации. Вот краткая справка:

![](images/routing/terminology-component-tree.avif)

* Дерево (tree): Соглашение для визуализации иерархической структуры. Например, дерево компонентов с родительскими и дочерними компонентами, структура папок и т. д.
* Поддерево (subtree): Часть дерева, начинающаяся с нового корня и заканчивающаяся листьями.
* Корень (root): Первый узел в дереве или поддереве, например корневой макет.
* Лист (leaf): Узлы в поддереве, у которых нет дочерних узлов, например последний сегмент в пути URL.

![](images/routing/terminology-url-anatomy.avif)

* Сегмент URL (segment): Часть пути URL, разделенная косыми чертами '/'.
* URL путь (path): Часть URL, которая идет после домена (состоит из сегментов).

## App Router

В 13-й версии Next.js появился новый App Router, построенный на [React Server Components](https://nextjs.org/docs/app/building-your-application/rendering/server-components), который поддерживает общие макеты (layout), вложенную маршрутизацию (nested routs), состояния загрузки (loader), обработку ошибок (error) и многое другое.

App Router работает в директории под названием `app`. Директория `app` работает параллельно с директорией `pages` (старый тип маршрутизации Page Router), чтобы обеспечить постепенное внедрение. Это позволяет перевести некоторые маршруты вашего приложения на новое поведение, сохранив при этом другие маршруты в каталоге `pages` для прежнего поведения. Если ваше приложение использует каталог `pages`, обратитесь к документации [Pages Router](https://nextjs.org/docs/pages/building-your-application/routing).

Полезно знать: App Router имеет приоритет над Page Router. Роуты в этих директориях не должны совпадать (вести на один и тот же URL-путь) и будут вызывать ошибку во время сборки, чтобы предотвратить конфликт.

![](images/routing/next-router-directories.avif)

По умолчанию компоненты внутри приложения - это серверные компоненты ([React Server Components](https://nextjs.org/docs/app/building-your-application/rendering/server-components)). Это сделано для оптимизация производительности, также позволяет использовать клиентские компоненты ([Client Components](https://nextjs.org/docs/app/building-your-application/rendering/client-components)).

Рекомендация: Ознакомьтесь со страницей [Сервер](https://nextjs.org/docs/app/building-your-application/rendering/server-components), если вы новичок в серверных компонентах.

## Роли папок и файлов

Next.js использует роутинг на основе файловой системы:

* Папки используются для определения имен сегментов роутов (маршрутов). Роут - это единый путь вложенных папок, следующий по иерархии файловой системы от корневой папки до конечной папки (leaf), включающей файл page.js. См. раздел "[Определение маршрутов](https://nextjs.org/docs/app/building-your-application/routing/defining-routes)".
* Файлы используются для создания пользовательского интерфейса, который отображается для соответствующего сегмента маршрута. См. раздел "[Специальные файлы](https://nextjs.org/docs/app/building-your-application/routing#file-conventions)".

## Сегменты маршрута

Каждая папка в маршруте представляет собой сегмент маршрута. Каждый сегмент маршрута сопоставляется с соответствующим сегментом в пути URL.

![](images/routing/route-segments-to-path-segments.avif)

## Вложенные маршруты

Чтобы создать вложенный роут, вы можете вложить папки друг в друга. Например, вы можете добавить новый роут `/dashboard/settings`, вложив две новые папки в каталог `app`.

Роут `/dashboard/settings` состоит из трех сегментов:

* `/` (корневой сегмент)
* `dashboard` (сегмент)
* `settings` (конечный сегмент - лист)

## Назначение файлов

Next.js предоставляет набор специальных файлов для создания пользовательского интерфейса с определенным поведением во вложенных роутах:

* `layout` - Компонент общего макета для сегмента и его дочерних элементов
* `page` - Компронент страницы для роута, делает доступной страницу по данному роуту
* `loading` - Компонент лоадера для сегмента и его дочерних элементов
* `not-found` - Компонент страницы Not Found для сегмента и его дочерних элементов
* `error` - Компонент ошибки для сегмента и его дочерних элементов
* `global-error` - Компонент ошибок для всего приложения
* `rout` - файл для описания эндпоинтов API на стороне сервера
* `template` - Компонент общего шаблона для сегмента (в отличае от layout ререндерится при навигации по страницам)
* `default` - Компонент по умолчанию (fallback) для параллельных маршрутов (в случае, если человек перешел на страницу по прямому url)

Полезно знать: для специальных файлов можно использовать расширения .js, .jsx или .tsx.

## Иерархия компонентов (вложенность)

Компоненты React, определенные в специальных файлах сегмента роута, отображаются в определенной иерархии:

* `layout.js`
* `template.js`
* `error.js` (граница ошибок React)
* `loading.js` (граница React suspense)
* `not-found.js` (граница ошибки React)
* `page.js` или вложенный layout.js

![](images/routing/file-conventions-component-hierarchy.avif)

Во вложенном роуте компоненты сегмента будут вложены внутрь компонентов его родительского сегмента.

![](images/routing/nested-file-conventions-component-hierarchy.avif)

## Размещение файлов проекта

Помимо специальных файлов, у вас есть возможность размещать свои собственные файлы (например, компоненты, стили, тесты и т. д.) в папках в каталоге приложения.

Это связано с тем, что, хотя папки определяют роуты, но только содержимое файлов page.js или route.js делают доступными имена сегментов роута (имя папки станет маршрутом, только если внутри есть файл page.js или route.js).

![](images/routing/project-organization-colocation.avif)

## Расширенные шаблоны роутинга

App Router также предоставляет набор соглашений, которые помогут вам реализовать более сложные шаблоны роутинга. К ним относятся:

* Параллельные маршруты: Позволяют одновременно отображать две или более страниц в одном представлении, по которым можно осуществлять навигацию (переходить по страницам) независимо друг от друга. Их можно использовать для разделенных представлений с собственной поднавигацией. Например, дашборды.
* Перехватывающие маршруты: Позволяют перехватить роут и показать его в контексте другого роута. Их можно использовать, когда важно сохранить контекст текущей страницы. Например, просмотр всех задач при редактировании одной задачи или показать альбом фотографий в ленте.
  Эти паттерны позволяют создавать более богатые и сложные пользовательские интерфейсы, упрощая функции, которые исторически были сложны для реализации небольшими командами и отдельными разработчиками.
